<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<title> InvoiceUnapply&amp;() </title>
<script type="text/javascript" src="open_parent.js"></script>
<link rel="stylesheet" type="text/css" href="pkc.css">
<link rel="stylesheet" type="text/css" href="stylesheet.css">
<meta name="description" content="Configurer's Reference Guide for Singleview Convergent Billing 9.1 ">
<script language="javascript" type="text/javascript" src="dhtml_toc.js"></script>
<script language="JavaScript">
<!--

document.onkeydown = checkChangePage;
function checkChangePage(e)
{
   if (!e) var e = window.event;
   // Don't put the following into the first page
   if ((e.ctrlKey && (e.keyCode == 37))) {
      // Ctrl-Left Arrow was pressed or Page up key pressed at the top of the page
      document.location.href = "13397.htm";
   } else
   // Don't put the following into the late page for a document
   if ((e.ctrlKey && (e.keyCode == 39))) {
      // Ctrl-Right Arrow was pressed or Page down key pressed and at the bottom of the page
      document.location.href = "13399.htm";
   }
}

function MM_swapImgRestore() { //v3.0
  var i,x,a=document.MM_sr; for(i=0;a&&i<a.length&&(x=a[i])&&x.oSrc;i++) x.src=x.oSrc;
}

function MM_preloadImages() { //v3.0
  var d=document; if(d.images){ if(!d.MM_p) d.MM_p=new Array();
    var i,j=d.MM_p.length,a=MM_preloadImages.arguments; for(i=0; i<a.length; i++)
    if (a[i].indexOf("#")!=0){ d.MM_p[j]=new Image; d.MM_p[j++].src=a[i];}}
}

function MM_findObj(n, d) { //v4.0
  var p,i,x;  if(!d) d=document; if((p=n.indexOf("?"))>0&&parent.frames.length) {
    d=parent.frames[n.substring(p+1)].document; n=n.substring(0,p);}
  if(!(x=d[n])&&d.all) x=d.all[n]; for (i=0;!x&&i<d.forms.length;i++) x=d.forms[i][n];
  for(i=0;!x&&d.layers&&i<d.layers.length;i++) x=MM_findObj(n,d.layers[i].document);
  if(!x && document.getElementById) x=document.getElementById(n); return x;
}

function MM_swapImage() { //v3.0
  var i,j=0,x,a=MM_swapImage.arguments; document.MM_sr=new Array; for(i=0;i<(a.length-2);i+=3)
   if ((x=MM_findObj(a[i]))!=null){document.MM_sr[j++]=x; if(!x.oSrc) x.oSrc=x.src; x.src=a[i+2];}
}

function printpage()
{
	window.print();
}
//-->
</script>
</head>
<body onload="loadParent();MM_preloadImages('left_down.gif','right_down.gif','index_down.gif','contents_down.gif','search_down.gif','print_down.gif');if (isTOCLoaded()) {expand('11007');expand('10992');highlight('57671')}">
<div class="menubar">  <table width="100%" border="0" cellspacing="0" cellpadding="0">    <tr valign="middle">      <td width="70">        <a href="13397.htm" onMouseOut="MM_swapImgRestore()" onMouseOver="MM_swapImage('left','','left_down.gif',1)">        <img name="left" border="0" src="left_up.gif" width="26" height="26" alt="Previous topic" title="Previous topic"></a>        <a href="13399.htm" onMouseOut="MM_swapImgRestore()" onMouseOver="MM_swapImage('right','','right_down.gif',1)">        <img name="right" border="0" src="right_up.gif" width="26" height="26" alt="Next topic" title="Next topic"></a></td>        <td class="bodytext">Configurer's Reference Guide for Singleview Convergent Billing 9.1 </td>        <td width="40">        <div align="center">        <a href="javascript:printpage();" onMouseOut="MM_swapImgRestore()" onMouseOver="MM_swapImage('print','','print_down.gif',1)">        <img name="print" border="0" src="print_up.gif" width="26" height="26" alt="Print this page" title="Print this page"></a>      </div>       </td></tr>  </table></div><table width="100%" cellpadding="0" cellspacing="0" border="0"><tr><td width="100%">
<h3 class="heading3">InvoiceUnapply&amp;()</h3>
</td><td class="feedback"><p><a href="mailto:ipoint@csgi.com?subject=Feedback on Topic 'InvoiceUnapply&amp;()' (57671)"><img border=0 src="email.png" alt="Provide feedback on this topic"></a></p></td></tr></table><p class="syntaxheading">Syntax</p>
<pre class="unixinputp">InvoiceUnapply&amp;(    BillRunId&amp;,    EffectiveDate~,    BillRunOperationId&amp;,    const&nbsp;RootCustomerNodeList&amp;[],    var&nbsp;SuccessCustomerNodeList&amp;[],    var&nbsp;ErrorCustomerNodeList&amp;[],    var&nbsp;OperationStatistics?{})</pre>
<p class="bodytext">&nbsp;</p>
<p class="syntaxheading">Description</p>
<p class="bodytext">Takes an ordered list of root customer node IDs and, for each root customer, retrieves all invoices for the specified bill run associated with all customer nodes (in the specified root customer's hierarchy).</p>
<p class="syntaxheading">Attributes</p>
<table class="tableintopic" width="294" cellpadding="2" cellspacing="0" border="1" style="border-collapse:collapse; border:1px solid #010101">
<tr align="left" valign="top">
<td style="border:1px solid #010101;" width="192"><p class="tablebodytext"><span class="bold">Application Environment</span></p>
</td>
<td style="border:1px solid #010101;" width="102"><p class="tablebodytext">Any</p>
</td>
</tr>
<tr align="left" valign="top">
<td style="border:1px solid #010101;" width="192"><p class="tablebodytext"><span class="bold">Context</span></p>
</td>
<td style="border:1px solid #010101;" width="102"><p class="tablebodytext">Any</p>
</td>
</tr>
<tr align="left" valign="top">
<td style="border:1px solid #010101;" width="192"><p class="tablebodytext"><span class="bold">Method</span></p>
</td>
<td style="border:1px solid #010101;" width="102"><p class="tablebodytext">Local</p>
</td>
</tr>

</table>
<p class="bodytext">&nbsp;</p>
<table class="tableintopic" width="696" cellpadding="2" cellspacing="0" border="1" style="border-collapse:collapse; border:1px solid #010101">
<tr align="left" valign="top">
<td class="tableheading" style="border:1px solid #010101;" width="234"><p class="tableheading">Parameter</p>
</td>
<td class="tableheading" style="border:1px solid #010101;" width="462"><p class="tableheading">Description</p>
</td>
</tr>
<tr align="left" valign="top">
<td style="border:1px solid #010101;" width="234"><p class="tablebodytext"><span class="unixoutputc">BillRunId&amp;</span></p>
</td>
<td style="border:1px solid #010101;" width="462"><p class="tablebodytext">In:  ID of the bill run generating the un-applied invoices.</p>
</td>
</tr>
<tr align="left" valign="top">
<td style="border:1px solid #010101;" width="234"><p class="tablebodytext"><span class="unixoutputc">EffectiveDate~</span></p>
</td>
<td style="border:1px solid #010101;" width="462"><p class="tablebodytext">In:  Effective date of the bill run.</p>
</td>
</tr>
<tr align="left" valign="top">
<td style="border:1px solid #010101;" width="234"><p class="tablebodytext"><span class="unixoutputc">BillRunOperationId&amp;</span></p>
</td>
<td style="border:1px solid #010101;" width="462"><p class="tablebodytext">In:  ID of the bill run operation.</p>
</td>
</tr>
<tr align="left" valign="top">
<td style="border:1px solid #010101;" width="234"><p class="tablebodytext"><span class="unixoutputc">RootCustomerNodeList&amp;[]</span></p>
</td>
<td style="border:1px solid #010101;" width="462"><p class="tablebodytext">In:  List of root customer nodes whose invoices are being un-applied.</p>
<p class="tablebodytext">It cannot be empty.</p>
</td>
</tr>
<tr align="left" valign="top">
<td style="border:1px solid #010101;" width="234"><p class="tablebodytext"><span class="unixoutputc">SuccessCustomerNodeList&amp;[]</span></p>
</td>
<td style="border:1px solid #010101;" width="462"><p class="tablebodytext">Out:  List of all root customer nodes successfully processed.</p>
<p class="tablebodytext">It is a subset of the <span class="unixoutputc">RootCustomerNodeList&amp;[]</span> parameter, and must preserve the <span class="unixoutputc">RootCustomerNodeList&amp;[]</span> order.</p>
</td>
</tr>
<tr align="left" valign="top">
<td style="border:1px solid #010101;" width="234"><p class="tablebodytext"><span class="unixoutputc">ErrorCustomerNodeList&amp;[]</span></p>
</td>
<td style="border:1px solid #010101;" width="462"><p class="tablebodytext">Out:  List of root customer nodes for which there were either no invoices or no applied invoices associated with the specified bill run.</p>
</td>
</tr>
<tr align="left" valign="top">
<td style="border:1px solid #010101;" width="234"><p class="tablebodytext"><span class="unixoutputc">OperationStatistics?{}</span></p>
</td>
<td style="border:1px solid #010101;" width="462"><p class="tablebodytext">Out:  Unknown EPM hash containing the statistics gathered during the processing of the list of root customers.</p>
<p class="tablebodytext">The table below lists the parameter hash keys.</p>
</td>
</tr>

</table>
<p class="bodytext">&nbsp;</p>
<p class="syntaxheading">Returns</p>
<p class="bodytext">1 (TRUE) if successful; otherwise, an error is raised.  If the bill run is a Quality Assurance run, an error is raised.</p>
<p class="bodytext">If an error occurs when processing a customer, some invoices (but not all invoices) for the customer's hierarchy may be unapplied (because commit checks are performed following the unapply of each invoice).</p>
<p class="syntaxheading">Remarks</p>
<p class="bodytext">Each invoice is processed individually and un-applied from its associated account.</p>
<p class="bodytext">If a customer hierarchy does not have any invoices, or if no applied invoices are associated with the specified bill run, the root customer is included in <span class="unixoutputc">ErrorCustomerNodeList&amp;[]</span>.  A record is inserted into the <span class="unixoutputc">CUSTOMER_NODE_BILL_RUN</span> table with a status of Failure and a message indicating that no applied invoices associated with the specified bill run were retrieved for the customer hierarchy.  The next root customer node in <span class="unixoutputc">RootCustomerNodeList&amp;[]</span> is then processed.</p>
<p class="bodytext">If only some of the invoices for the customer hierarchy have been applied, when all the applied invoices have been unapplied, a record is inserted into the <span class="unixoutputc">CUSTOMER_NODE_BILL_RUN</span> table with a status of Success and a message specifying the number of invoices in the customer hierarchy unapplied.  The next root customer node in <span class="unixoutputc">RootCustomerNodeList&amp;[]</span> is then processed.</p>
<p class="bodytext">A record is inserted into the <span class="unixoutputc">CUSTOMER_NODE_BILL_RUN</span> table, with a status of Failure and a message, and the root customer node ID is placed into the <span class="unixoutputc">ErrorCustomerNodeList&amp;[]</span>, if any of the following conditions are satisfied:</p>
<ul class="listbullet"><li class="listbullet">A payment is either partially or completely allocated to the invoice.</li><li class="listbullet">An adjustment is either partially or completely allocated to the invoice.</li><li class="listbullet">A dispute is raised against the invoice.</li><li class="listbullet">The account transaction associated with the invoice is uploaded to the General Ledger (GL) system.</li><li class="listbullet">Part or all of the invoice is posted to the Sales Journal.</li><li class="listbullet">The invoice is not the most recently-applied invoice for its associated account.</li></ul><p class="bodytext">If <span class="unixoutputc">biInvoiceUnapply&amp;()</span> has determined that all relevant invoices in a customer hierarchy are valid, each invoice is processed individually.  The <span class="unixoutputc">INVOICE</span> table and the associated <span class="unixoutputc">ACCOUNT</span> table record for each invoice is updated to indicate that the invoice has not been applied.   </p>
<table width="100%" class="notestyle"><tr><td><p class="note">Note:</p><p class="note">If the unapplied entity is a statement pending consolidation, or is associated with a consolidation invoice, no <span class="unixoutputc">ACCOUNT</span> table records require reversal.</p></td></tr></table>
<p class="bodytext">Once all invoices for the specified customer hierarchy are unapplied successfully, a record is inserted into the <span class="unixoutputc">CUSTOMER_NODE_BILL_RUN</span> table for the given root customer node with the status of Success.  The root customer node ID is placed in <span class="unixoutputc">SuccessCustomerNodeList&amp;[]</span>.  The next root customer node ID in <span class="unixoutputc">RootCustomerNodeList&amp;[]</span> is processed.  </p>
<p class="bodytext">For each updated account, if an account balance function is defined for the associated account type, the function is called and any requested account changes are applied to the account (see the <span class="referrals">Finance Guide for Singleview</span>).</p>
<p class="bodytext">Accounts associated with the invoices processed are purged from the account cache by a call to <span class="unixoutputc">biAccountPurge&amp;()</span>.</p>
<p class="bodytext">The following table lists the hash keys for the <span class="unixoutputc">OperationStatistics?{}</span> parameter.</p>
<p class="bodytext">&nbsp;</p>
<p class="caption">OperationStatistics?{} Parameter Hash Keys</p>
<table class="tableintopic" width="510" cellpadding="2" cellspacing="0" border="1" style="border-collapse:collapse; border:1px solid #010101">
<tr align="left" valign="top">
<td class="tableheading" style="border:1px solid #010101;" width="186"><p class="tableheading">Key</p>
</td>
<td class="tableheading" style="border:1px solid #010101;" width="324"><p class="tableheading">Value</p>
</td>
</tr>
<tr align="left" valign="top">
<td style="border:1px solid #010101;" width="186"><p class="tablebodytext"><span class="unixoutputc">InvoicesApplied</span></p>
</td>
<td style="border:1px solid #010101;" width="324"><p class="tablebodytext">Number of invoices unapplied.</p>
</td>
</tr>
<tr align="left" valign="top">
<td style="border:1px solid #010101;" width="186"><p class="tablebodytext"><span class="unixoutputc">AmountApplied</span></p>
</td>
<td style="border:1px solid #010101;" width="324"><p class="tablebodytext">Total amount unapplied.</p>
</td>
</tr>

</table>
<p class="bodytext">&nbsp;</p>


<br><div class="menubar">  <table width="100%" border="0" cellspacing="0" cellpadding="0">    <tr valign="middle">      <td width="70">        <a href="13397.htm" onMouseOut="MM_swapImgRestore()" onMouseOver="MM_swapImage('left','','left_down.gif',1)">        <img name="left" border="0" src="left_up.gif" width="26" height="26" alt="Previous topic" title="Previous topic"></a>        <a href="13399.htm" onMouseOut="MM_swapImgRestore()" onMouseOver="MM_swapImage('right','','right_down.gif',1)">        <img name="right" border="0" src="right_up.gif" width="26" height="26" alt="Next topic" title="Next topic"></a></td>        <td class="bodytext">Configurer's Reference Guide for Singleview Convergent Billing 9.1 </td>        <td width="40">        <div align="center">        <a href="javascript:printpage();" onMouseOut="MM_swapImgRestore()" onMouseOver="MM_swapImage('print','','print_down.gif',1)">        <img name="print" border="0" src="print_up.gif" width="26" height="26" alt="Print this page" title="Print this page"></a>      </div>       </td></tr>  </table></div></body>
</html>


